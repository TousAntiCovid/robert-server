include:
  - project: stopcovid19/accueil
    ref: master
    file: gitlab/gitlab-ci-java-template.yml

docker-version:
  image: registry.gitlab.inria.fr/stemcovid19/tac-server/docker-image/tac-system-tests:latest
  stage: build
  script:
    - docker version

e2e-tests-docker:
  script:
    - until curl -s http://robert-server-ws-rest:8086/actuator/health | grep -q UP; do sleep 0.5; done;
    - java -jar robert-e2e-tests/target/robert-e2e-tests-*.jar

deploy-int:
  stage: deploy
  variables:
    APP_VERSION: develop-SNAPSHOT
  trigger:
    project: stemcovid19/infrastructure/functional-zone/services/robert/robert-ansible
    branch: master
    strategy: depend
  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'
